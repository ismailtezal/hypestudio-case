# PostgreSQL Configuration Optimizations for Large JSONB Datasets
# Add these to your postgresql.conf or as environment variables

# Memory Settings (adjust based on your server specs)
shared_buffers = 1GB                    # 25% of total RAM
effective_cache_size = 4GB              # 75% of total RAM  
work_mem = 256MB                        # For large sorts/joins
maintenance_work_mem = 1GB              # For index creation/VACUUM

# Query Planner Settings
random_page_cost = 1.1                  # SSD optimization
seq_page_cost = 1.0                     # Sequential read cost
cpu_tuple_cost = 0.01                   # CPU processing cost
cpu_index_tuple_cost = 0.005            # Index lookup cost
default_statistics_target = 1000        # Better query planning

# Connection Settings  
max_connections = 200                   # Adjust based on your needs
shared_preload_libraries = 'pg_stat_statements' # Query monitoring

# Write Ahead Log (WAL) Settings
wal_buffers = 16MB                      # WAL buffer size
checkpoint_completion_target = 0.9       # Smoother checkpoints
max_wal_size = 4GB                      # Larger WAL for bulk operations
min_wal_size = 1GB                      # Minimum WAL size

# Logging for Performance Monitoring
log_min_duration_statement = 1000       # Log slow queries (1 second)
log_checkpoints = on                    # Monitor checkpoint performance
log_lock_waits = on                     # Monitor lock contention
log_temp_files = 100MB                  # Log large temp files

# JSONB Specific Optimizations
# These are set at connection level in our pool configuration
# gin_fuzzy_search_limit = 0            # No limit on GIN index searches
# gin_pending_list_limit = 4MB          # Larger pending list for GIN

# Connection Pooling (pgBouncer recommended for production)
# pool_mode = transaction                # Transaction-level pooling
# max_client_conn = 1000                 # Maximum client connections
# default_pool_size = 25                 # Connections per pool

# Autovacuum Settings for Large Tables
autovacuum_max_workers = 6              # More vacuum workers
autovacuum_naptime = 30s                # More frequent autovacuum checks
autovacuum_vacuum_scale_factor = 0.1    # Vacuum at 10% dead tuples
autovacuum_analyze_scale_factor = 0.05  # Analyze at 5% changed tuples

# Background Writer Settings
bgwriter_delay = 50ms                   # Background writer frequency
bgwriter_lru_maxpages = 1000           # Pages to write per round
bgwriter_lru_multiplier = 10.0         # Multiplier for LRU pages
